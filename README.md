# ふるさと納税 上限目安計算ツール

このリポジトリは、給与収入や副業収入、各種所得控除の入力から、ふるさと納税の「上限目安額」を簡易に見積もるスクリプトを提供します。主に `scripts/calc_furusato.py` を用います。入力は YAML で与えます。

注意: 本ツールは簡易推計です。厳密な税額・上限を保証するものではありません。詳細は「制約・注意点」を参照してください。

## 法的根拠（簡易化の前提）
- 所得税: 所得税法に基づく超過累進税率（5%/10%/20%/23%/33%/40%/45%）の速算表を前提に、課税所得に対する税額（復興特別所得税は未考慮）を簡易計算します。
- 住民税: 地方税法に基づく住民税の「所得割」10%のみを簡易計算します（均等割、調整控除、配当控除等は未考慮）。
- ふるさと納税（寄附金税額控除）: 住民税の特例控除には「住民税所得割額の20%」という上限があります。本ツールは「所得税額＋住民税（所得割）」の合計の20%を目安とする簡易式で上限額を推定しています。

上記は各法令・自治体の公開資料に基づく一般的な枠組みを要約したもので、最新の法改正や個別事情すべてを反映するものではありません。

## 制約・注意点
- 簡易モデルです: 復興特別所得税、住民税の均等割・調整控除、住宅ローン控除、医療費控除、配当控除、配偶者（特別）控除、扶養控除等の多くの控除・税額控除は未考慮です。
- 分離課税等は未対応: 株式・投資等の分離課税（申告分離・源泉分離）や損益通算の扱いは現実とは異なる可能性があります。
- 自己負担2,000円の扱い: 出力する「上限目安」は“実質負担が約2,000円に収まる水準”を目標とした概算です。実際の控除額・上限は個別事情により変動します。
- 端数処理: 上限目安は100円単位で切り捨てます。

厳密な金額が必要な場合は、自治体や国税庁等の公式シミュレーターや専門家の確認を併用してください。本ドキュメントは一般的説明であり、法的助言ではありません。

## 使い方

### 1) 依存関係
- Python 3.9+ を推奨
- 追加ライブラリ: `PyYAML`
  - インストール例: `pip install pyyaml`

### 2) 入力データ（YAML）
次の2通りの入力が可能です。
- そのまま使用する（英字キーの「正規化済み」形式）
- 日本語キーで用意し、`scripts/normalize_data.py` で正規化する

正規化済みの英字キー（これらのキー名で YAML を用意すれば正規化は不要）
- `salary_income`: 給与収入（円）
- `side_income`: 副業収入（円）
- `expense_rate`: 副業の経費率（0〜1、例: 0.3）
- `capital_gains`: 投資差益（円、簡易合算）
- `social_insurance`: 社会保険料控除（円）
- `dc_matching`: DCマッチング拠出（小規模な上乗せ掛金等、所得控除扱い）（円）
- `ideco`: iDeCo拠出（円）
- `small_business`: 小規模企業共済掛金（円）
- `basic_deduction`: 基礎控除（円）

日本語キー → 英字キーのマッピング（`scripts/normalize_data.py` が使用）
- `給与収入` → `salary_income`
- `副業収入` → `side_income`
- `投資差益` → `capital_gains`
- `経費率` → `expense_rate`（例: `30%` でも可）
- `社会保険料` → `social_insurance`
- `基礎控除` → `basic_deduction`
- `dcマッチング拠出` → `dc_matching`
- `iDeCo拠出` → `ideco`
- `小規模企業共済` → `small_business`

### 3) 日本語キーの入力を正規化（任意）
```bash
python scripts/normalize_data.py input_ja.yml normalized.yml
```

### 4) 上限目安の計算
```bash
python scripts/calc_furusato.py normalized.yml
# もしくは、正規化済みの YAML を直接指定
python scripts/calc_furusato.py input_en.yml
```

## 計算ロジック（概要）
- 給与所得控除後の所得: `salary_income_after_deduction(給与収入)` の段階関数で近似
- 課税所得: `給与所得 +（副業収入×(1-経費率)) + 投資差益 − 各種所得控除`
- 所得税額（簡易）: 速算表（5%〜45%）に基づき算出（復興特別所得税なし）
- 住民税（簡易）: `課税所得 × 10%`（所得割のみ）
- 上限目安: `(所得税額 + 住民税) × 20%` を100円単位で切り捨て

詳細は `scripts/calc_furusato.py` を参照してください。

## 明瞭な計算例

入力例（正規化済みの YAML、`example.yml`）
```yaml
salary_income: 7000000       # 給与収入
side_income: 300000          # 副業収入
expense_rate: 0.3            # 経費率 30%
capital_gains: 100000        # 投資差益（簡易）
social_insurance: 900000     # 社会保険料
dc_matching: 240000          # DCマッチング拠出
ideco: 276000                # iDeCo
small_business: 0            # 小規模企業共済
basic_deduction: 480000      # 基礎控除（多くのケースで48万円）
```

実行
```bash
python scripts/calc_furusato.py example.yml
```

出力例（概算）
```text
Total income: 5410000
Taxable income: 3514000
Approximate donation limit: 125300円
```

上記の意味
- Total income: 給与所得控除後の給与 + 副業（経費差引後）+ 投資差益 の合計
- Taxable income: 上記合計 −（社会保険料、iDeCo、基礎控除 等）
- Approximate donation limit: 本ツールの簡易式で推定した上限目安（100円単位切捨て）

## フォルダ構成（抜粋）
- `scripts/calc_furusato.py`: 上限目安の計算スクリプト
- `scripts/normalize_data.py`: 日本語キーの入力を正規化する補助スクリプト
- `web/`: 簡易的なブラウザ UI（参考用）

## 免責事項
本ツールおよびドキュメントは一般的な情報提供のみを目的としており、法的・税務上の助言ではありません。実際の申告・控除の可否や金額は、最新の法令、自治体の運用、個別事情により異なります。最終判断は必ず公的資料や専門家の見解でご確認ください。
